<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" 
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">
 
<sqlMap namespace="employees">

<!-- 
	 	사용자정보를 전달받아서 comm_employees 테이블에 저장한다.
	  -->
	  
	  <insert id="insertEmployee" parameterClass="com.community.vo.Employee">
	  	insert into comm_employees
	  		(emp_no, emp_password, emp_name, emp_email, emp_phone, emp_dept_no, emp_position_no)
	  	values
	  		(comm_employees_seq.nextval, #password#, #name#, #email#, #phone#, #department.no#, #position.no#)
	  </insert>
<!-- 
		아이디를 전달받아 comm_employees 테이블에서 사용자정보를 조회하여 employee객체 반환
	 -->
	 
	 <select id="getEmployeeByNo" parameterClass="int" resultClass="com.community.vo.Employee">
	 	select
	 		emp_no					as empNo,
	 		emp_password 			as password,
	 		emp_name 				as name, 
	 		emp_email 				as email,
	 		emp_phone 				as phone,
	 		emp_type				as type,
	 		emp_dept_no 			as "department.no",
	 		emp_position_no 		as "position.no",
	 		emp_deleted 			as deleted,
	 		emp_created_date 		as createdDate,
	 		emp_updated_date 		as updatedDate
	 	from
	 		comm_employees
	 	where
	 		emp_no = #value#
	 		and emp_deleted = 'N'
	 </select>
	 
	 <!-- 
		이메일을 전달받아 comm_employees 테이블에서 사용자정보를 조회하여 employee객체 반환
	 -->
	 
	 <select id="getEmployeeByEmail" parameterClass="string" resultClass="com.community.vo.Employee">
	 	select
	 		emp_no					as empNo,
	 		emp_password 			as password,
	 		emp_name 				as name, 
	 		emp_email 				as email,
	 		emp_phone 				as phone,
	 		emp_type				as type,
	 		emp_dept_no 			as "department.no",
	 		emp_position_no 		as "position.no",
	 		emp_deleted 			as deleted,
	 		emp_created_date 		as createdDate,
	 		emp_updated_date 		as updatedDate
	 	from
	 		comm_employees
	 	where
	 		emp_email = #value#
	 </select>
	 
	 <!-- 
		Id가 동일한 Employee객체값 업데이트
	 -->
	 <update id="updateEmployee" parameterClass="com.community.vo.Employee">
		update 
			comm_employees
		set
	 		emp_password = #password#,
	 		emp_name = #name#, 
	 		emp_email = #email#,
	 		emp_phone = #phone#,
	 		emp_dept_no = #department.no#,
	 		emp_position_no = #position.no#,
	 		emp_updated_date = sysdate
		where
			emp_no = #empNo#
	</update>
	
	<select id="getEmployeeByNoJoin" parameterClass="int" resultClass="com.community.vo.Employee">
		select
	 		A.emp_no				as empNo,
	 		A.emp_password 			as password,
	 		A.emp_name 				as name, 
	 		A.emp_email 			as email,
	 		A.emp_phone 			as phone,
	 		A.emp_dept_no 			as "department.no",
            B.department_name       as "department.name",
	 		A.emp_position_no 		as "position.no",
            C.position_name         as "position.name",
	 		A.emp_deleted 			as deleted,
	 		A.emp_created_date 		as createdDate,
	 		A.emp_updated_date 		as updatedDate
	 	from
	 		comm_employees A, comm_departments B, comm_positions C
	 	where
            A.emp_dept_no = B.department_no
            and A.emp_position_no = C.position_no
            and emp_no = #value#
	</select>
	 
</sqlMap>

