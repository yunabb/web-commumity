<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" 
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">

 
<sqlMap namespace="storyposts">
	
	<!-- 
		사는이야기 게시판 새 게시글 정보 등록 
	 -->
	<insert id="insertStoryPost" parameterClass="com.community.vo.StoryPost">
		insert into comm_posts
			(post_no, post_board_no, post_title, post_writer_no, post_content)
		values
			(comm_posts_seq.nextval, #board.boardNo#, #title#, #employee.empNo#, #content#)	
	</insert>
	
	<!--  
		사는이야기 게시판의 게시글 번호를 전달받아서 게시글 정보 수정
	-->
	<update id="updateStoryPost" parameterClass="com.community.vo.StoryPost">
		update
			comm_posts
		set
			post_title = #title#,
			post_content = #content#,
			post_important = #important#,
			post_read_count = #readCount#,
			post_suggestion_count = #suggestionCount#,
			post_comment_count = #commentCont#,
			post_deleted = #deleted#,
			post_updated_date = sysdate,
			post_deleted_date = sysdate
		where
			post_no = #no#		
	</update>
	
	<!-- 
		사는이야기 게시판의 게시글 총 갯수 조회 
	-->
	<select id="getTotalRows" resultClass="int">
		select 
			count(*)
		from 
			comm_posts
		where
			post_deleted = 'N'		
	</select>
	
	<!--
		사는이야기 게시판의 게시글 전체 목록 조회 및 페이징처리		
	 -->
	<select id="getStoryPosts" parameterClass="map" resultClass="com.community.vo.StoryPost">
		select
			post_no as postNo,
			post_board_no as "board.boardNo",
			post_title as title,
			post_writer_no as "employee.empNo",
			post_content as content,
			post_important as important,
			post_read_count as readCount,
			post_suggestion_count as suggestionCount,
			post_comment_count as commentCont,
			post_deleted as deleted,
			post_created_date as createdDate,
			post_updated_date as updatedDate,
			post_deleted_date as deletedDate
		from
			(select
				row_number() over (order by post_no desc) row_numbers,
				post_no,
				post_board_no,
				post_title,
				post_writer_no,
				post_content,
				post_important,
				post_read_count,
				post_suggestion_count,
				post_comment_count,
				post_deleted,
				post_created_date,
				post_updated_date,
				post_deleted_date
			from
				comm_posts
			where
				post_deleted = 'N')		
		where
			row_numbers between #begin# and #end#			
	</select>	
	
	<!-- 
		사는이야기 게시판의 게시글 번호를 전달받아서 게시글 상세 정보 조회
	 -->
	<select id="getStoryPostByNo" parameterClass="int" resultClass="com.community.vo.StoryPost">
		select
			post_no as postNo,
			post_board_no as "board.boardNo",
			post_title as title,
			post_writer_no as "employee.empNo",
			post_content as content,
			post_important as important,
			post_read_count as readCount,
			post_suggestion_count as suggestionCount,
			post_comment_count as commentCont,
			post_deleted as deleted,
			post_created_date as createdDate,
			post_updated_date as updatedDate,
			post_deleted_date as deletedDate
		from
			comm_posts
		where
			post_no = #value#			
	</select>
	
</sqlMap>

